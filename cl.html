<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no"/>
<title>AI Commerce Demo ‚Äî Gemini</title>
<link rel="preconnect" href="https://fonts.googleapis.com"/>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
<link href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@400;500;700&family=Google+Sans+Text:wght@400;500&display=swap" rel="stylesheet"/>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --bg:#ffffff;
  --surface:#f8f9fa;
  --text:#1f1f1f;
  --text2:#444746;
  --text3:#70757a;
  --border:#e3e3e3;
  --accent:#1a73e8;
  --link:#1a73e8;
  --input-bg:#f0f4f9;
}
body{
  font-family:'Google Sans','Google Sans Text',-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;
  background:#e8eaed;min-height:100vh;
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  padding:20px;-webkit-font-smoothing:antialiased;
}

.controls{display:flex;gap:10px;margin-bottom:16px;align-items:center;flex-wrap:wrap;justify-content:center}
.controls button{padding:8px 18px;border-radius:20px;border:1px solid #dadce0;background:#fff;color:#444;cursor:pointer;font-size:13px;font-family:inherit;font-weight:500;transition:all .15s}
.controls button:hover:not(:disabled){background:#f1f3f4}
.controls button.primary{background:#1a73e8;color:#fff;border-color:#1a73e8}
.controls button:disabled{opacity:.35;cursor:default}
.controls .counter{font-size:12px;color:#70757a;min-width:40px;text-align:center}

.phone{
  width:393px;height:852px;border-radius:47px;background:var(--bg);
  border:3px solid #1f1f1f;overflow:hidden;display:flex;flex-direction:column;
  box-shadow:0 25px 80px rgba(0,0,0,.25);
}

/* STATUS BAR */
.status-bar{display:flex;justify-content:space-between;align-items:center;padding:12px 28px 6px;font-size:16px;font-weight:600;color:var(--text);flex-shrink:0}
.status-icons{display:flex;gap:5px;align-items:center}

/* HEADER */
.g-header{display:flex;align-items:center;justify-content:space-between;padding:6px 16px 10px;flex-shrink:0}
.g-header-left{display:flex;align-items:center;gap:10px}
.g-logo{width:30px;height:30px}
.g-back{display:flex;align-items:center;justify-content:center;width:24px;height:24px}
.avatar-circle{width:32px;height:32px;border-radius:50%;background:linear-gradient(135deg,#f4a261,#e76f51);display:flex;align-items:center;justify-content:center;font-size:14px;color:white;font-weight:600}

/* NAV TABS */
.nav-tabs{display:flex;gap:0;padding:0 16px;border-bottom:1px solid var(--border);flex-shrink:0}
.nav-tabs .tab{padding:10px 12px;font-size:14px;color:var(--text3);font-weight:500;white-space:nowrap;position:relative}
.nav-tabs .tab.active{color:#1a73e8}
.nav-tabs .tab.active::after{content:'';position:absolute;bottom:-1px;left:12px;right:12px;height:3px;background:#1a73e8;border-radius:3px 3px 0 0}

/* SCROLL */
.scroll-area{flex:1;overflow-y:auto;overflow-x:hidden}
.scroll-area::-webkit-scrollbar{width:0}

/* WELCOME */
.welcome{display:flex;flex-direction:column;align-items:center;padding:0 24px;min-height:100%}
.welcome-spacer{flex:1;min-height:80px}
.welcome h1{font-size:22px;font-weight:400;color:var(--text);text-align:center;line-height:1.35}
.welcome-bottom{flex:1;display:flex;flex-direction:column;justify-content:flex-end;width:100%;padding-bottom:8px}
.suggestion-item{display:flex;align-items:center;justify-content:space-between;padding:16px 0;border-top:1px solid var(--border)}
.suggestion-item:first-child{border-top:none}
.suggestion-item .stxt{font-size:14px;color:var(--text);line-height:1.45;flex:1;padding-right:12px}
.suggestion-item .sicon{flex-shrink:0;width:20px;height:20px}

/* ===== INPUT BAR ‚Äî pixel-matched to screenshot ===== */
.input-bar{flex-shrink:0;background:var(--bg);padding:6px 12px 0}

/* Composing state ‚Äî rounded grey box with text + dismiss X */
.input-compose-box{
  background:var(--input-bg);
  border-radius:24px;
  padding:16px 18px 16px 18px;
  position:relative;
}
.input-compose-text{
  font-size:16px;color:var(--text);line-height:1.5;font-family:inherit;
  padding-right:28px;
}
.input-dismiss{
  position:absolute;top:14px;right:14px;
  width:22px;height:22px;display:flex;align-items:center;justify-content:center;
  cursor:pointer;border:none;background:transparent;
}

/* Bottom row: + mic camera send */
.input-bottom-row{
  display:flex;align-items:center;justify-content:space-between;
  padding:10px 4px 2px;
}
.input-add-btn{
  width:34px;height:34px;border-radius:50%;
  border:1.5px solid var(--border);background:transparent;
  display:flex;align-items:center;justify-content:center;cursor:pointer;
}
.input-right-icons{display:flex;gap:16px;align-items:center}
.input-right-icons svg{display:block}

/* Send button ‚Äî filled blue circle */
.send-btn{
  width:38px;height:38px;border-radius:50%;
  background:#1a73e8;border:none;cursor:pointer;
  display:flex;align-items:center;justify-content:center;
  transition:background .15s;
}
.send-btn:hover{background:#1557b0}
.send-btn svg{display:block}

/* Empty input state */
.input-empty-row{display:flex;align-items:center;gap:10px;padding:8px 4px}
.input-placeholder{flex:1;font-size:16px;color:var(--text3)}
.input-empty-icons{display:flex;gap:16px;align-items:center}

/* HOME INDICATOR */
.home-ind{display:flex;justify-content:center;padding:8px 0 10px;flex-shrink:0}
.home-ind div{width:134px;height:5px;border-radius:3px;background:#1f1f1f}

/* MESSAGES */
.messages{padding:4px 0 12px}
.user-row{display:flex;justify-content:flex-end;padding:8px 16px 4px}
.user-msg{background:#e8edf3;border-radius:20px;padding:12px 16px;max-width:82%;font-size:16px;color:var(--text);line-height:1.5;animation:slideUp .25s ease-out}

/* AI */
.ai-block{padding:12px 20px 4px}
.ai-block .heading{font-size:16px;font-weight:700;color:var(--text);margin:18px 0 8px}
.ai-block .para{font-size:15px;color:var(--text2);line-height:1.65;margin:8px 0}
.ai-block .bullet{font-size:15px;color:var(--text2);line-height:1.65;margin:6px 0;padding-left:8px}
.ai-block b,.ai-block strong{color:var(--text);font-weight:600}

/* PRODUCT CARD */
.pcard{background:var(--bg);border:1px solid var(--border);border-radius:12px;padding:12px;margin:10px 0;display:flex;gap:12px;align-items:center}
.pcard .pthumb{width:72px;height:72px;border-radius:8px;background:#f1f3f4;display:flex;align-items:center;justify-content:center;flex-shrink:0}
.pcard .pinfo{flex:1;min-width:0}
.pcard .pname{font-size:14px;font-weight:500;color:var(--link);line-height:1.35;margin-bottom:2px}
.pcard .pprice{font-size:14px;color:var(--text);font-weight:500;margin-bottom:1px}
.pcard .pmeta{font-size:12px;color:var(--text3)}

/* TABLE ‚Äî no horizontal scroll */
.ctable{margin:14px 0;border:1px solid var(--border);border-radius:8px;overflow:hidden}
.ctable table{width:100%;border-collapse:collapse;font-size:11px;table-layout:fixed}
.ctable th{padding:8px 6px;background:var(--surface);color:var(--text);text-align:left;border-bottom:1px solid var(--border);font-weight:600;font-size:10px;overflow:hidden;text-overflow:ellipsis}
.ctable td{padding:8px 6px;color:var(--text2);border-bottom:1px solid #f0f0f0;vertical-align:top;line-height:1.35;font-size:11px;word-wrap:break-word;overflow-wrap:break-word}
.ctable tr:last-child td{border-bottom:none}
.ctable td:first-child{color:var(--text3);font-weight:500}
.ctable td b,.ctable td strong{color:var(--text);font-weight:600}

/* THINKING */
.thinking-row{padding:16px 20px;display:flex;align-items:center;gap:6px;animation:fadeIn .3s}
.thinking-dot{width:6px;height:6px;border-radius:50%;background:#1a73e8;animation:dotPulse 1.2s infinite}
.thinking-dot:nth-child(2){animation-delay:.2s}
.thinking-dot:nth-child(3){animation-delay:.4s}
.thinking-label{font-size:16px;color:var(--text2);font-style:italic;margin-left:4px}

.cursor{display:inline-block;width:2px;height:1em;background:#1a73e8;margin-left:1px;animation:blink .7s infinite;vertical-align:text-bottom}

@keyframes dotPulse{0%,80%,100%{opacity:.3;transform:scale(.8)}40%{opacity:1;transform:scale(1.1)}}
@keyframes blink{0%,100%{opacity:1}50%{opacity:0}}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
@keyframes slideUp{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}

@media(max-width:440px){
  body{padding:0;background:#fff}
  .phone{width:100vw;height:100vh;height:100dvh;border-radius:0;border:none;box-shadow:none}
  .controls{display:none}
}
</style>
</head>
<body>

<div class="controls" id="controls">
  <button onclick="resetDemo()">‚ü≤ Reset</button>
  <button id="autoBtn" onclick="toggleAutoPlay()">‚ñ∂ Auto Play</button>
  <button id="nextBtn" onclick="advance()" disabled>Next ‚Üí</button>
  <span class="counter" id="counter">1/5</span>
</div>

<div class="phone">
  <div class="status-bar">
    <span>9:41</span>
    <div class="status-icons">
      <svg width="17" height="12" viewBox="0 0 17 12" fill="#1f1f1f"><rect x="0" y="8" width="3" height="4" rx=".5"/><rect x="4.5" y="5" width="3" height="7" rx=".5"/><rect x="9" y="2" width="3" height="10" rx=".5"/><rect x="13.5" y="0" width="3" height="12" rx=".5"/></svg>
      <svg width="16" height="12" viewBox="0 0 16 12" fill="#1f1f1f"><path d="M8 3.6C9.8 3.6 11.4 4.3 12.6 5.4L14 4C12.4 2.5 10.3 1.5 8 1.5S3.6 2.5 2 4L3.4 5.4C4.6 4.3 6.2 3.6 8 3.6ZM8 7.2C9 7.2 9.9 7.6 10.6 8.2L12 6.8C10.9 5.8 9.5 5.1 8 5.1S5.1 5.8 4 6.8L5.4 8.2C6.1 7.6 7 7.2 8 7.2Z"/><circle cx="8" cy="10.5" r="1.5"/></svg>
      <svg width="27" height="13" viewBox="0 0 27 13" fill="none"><rect x=".5" y="1" width="23" height="11" rx="2.5" stroke="#1f1f1f" stroke-width="1"/><path d="M25 4.5v4a1.5 1.5 0 000-4z" fill="#1f1f1f"/><rect x="2" y="2.5" width="19" height="8" rx="1.5" fill="#1f1f1f"/></svg>
    </div>
  </div>
  <div id="header"></div>
  <div id="navTabs"></div>
  <div class="scroll-area" id="scrollArea"></div>
  <div id="inputBar"></div>
  <div class="home-ind"><div></div></div>
</div>

<script>
// ========== DATA ==========
const SCREENS=[
  {id:"welcome",type:"welcome"},
  {id:"u1",type:"user-sends",
   msg:"I'm scaling up my architecture practice‚Äîworking solo but taking on bigger projects. I need a laptop that handles 3D rendering and BIM software, lasts through full-day client meetings without needing a charger, and won't break the bank. What should I get?"},
  {id:"t1",type:"thinking"},
  {id:"a1",type:"ai-response",content:[
    {t:"p",text:"To handle architectural scaling, you need a machine that balances <b>single-core clock speed</b> for BIM modeling (Revit/ArchiCAD) with <b>multi-core/GPU power</b> for 3D rendering (V-Ray/Lumion)."},
    {t:"h",text:"Professional Workstation Options"},
    {t:"p",text:"These models are designed specifically for AEC (Architecture, Engineering, and Construction) workflows, featuring <b>ISV certifications</b> that guarantee software stability."},
    {t:"p",text:"The <b>Dell Pro 16 Plus</b> is a versatile choice for a growing practice. It offers a <b>16-inch display</b> and is powered by an <b>Intel Core Ultra processor</b> with a built-in <b>AI Boost NPU</b>, which helps manage background tasks to preserve battery life. It is rated for <b>up to 12.6 hours of runtime</b>."},
    {t:"card",name:"Dell Pro 16 Plus",price:"$1,449.00",brand:"Dell",rating:"4.1",reviews:"97k+"},
    {t:"p",text:"For those who prioritize mobility without sacrificing professional-grade graphics, the <b>HP ZBook 8 G1i</b> is a newly redesigned <b>16-inch mobile workstation</b>. It features <b>pro-level graphics</b> tailored for advanced AI and 3D workflows."},
    {t:"card",name:"HP ZBook 8 G1i 16\" Mobile Workstation Intel Core Ultra 7",price:"$1,699.00",brand:"HP",rating:"4.9",reviews:"41"},
    {t:"h",text:"Highly Portable Alternatives"},
    {t:"p",text:"The <b>Asus ProArt PX13</b> is a <b>13.3-inch convertible</b> with a <b>3K OLED touchscreen</b> and <b>Asus DialPad</b>. It packs an <b>RTX 4050 GPU</b> and <b>32GB of RAM</b>."},
    {t:"h",text:"Summary Recommendation"},
    {t:"li",text:"<b>For best BIM performance:</b> Choose the <b>HP ZBook 8 G1i</b>; its 32GB RAM and Intel Ultra processor provide stability for large Revit files."},
    {t:"li",text:"<b>For pure portability:</b> The <b>Asus Zenbook S 16</b> is the lightest 16-inch option that handles moderate 3D workloads."},
    {t:"table",headers:["","HP ZBook 8 G1i ‚≠ê","Dell Precision 16","Zenbook S 16"],rows:[
      ["Best For","Mobile workstation power","Raw performance","Max portability"],
      ["BIM","üéØ ISV-certified","Excellent 32GB","‚ö†Ô∏è Inadequate"],
      ["Battery","Up to 15 hrs","Limited under load","Excellent"],
      ["Price","$1,500‚Äì4,000+","$2,000‚Äì3,500","$1,200‚Äì1,800"]
    ]}
  ]},
  {id:"u2",type:"user-sends",
   msg:"I really like the HP option as I don't want to compromise on the performance element, also I have some 4k HD True colour monitors from HP, and I'm impressed."}
];

// ========== STATE ==========
let cur=0,autoP=false,busy=false,timer=null,dotTimer=null;
const hist=[];
const $=id=>document.getElementById(id);
const sleep=ms=>new Promise(r=>setTimeout(r,ms));
function sBot(){const e=$('scrollArea');e.scrollTop=e.scrollHeight}
function strip(h){const d=document.createElement('div');d.innerHTML=h;return d.textContent||''}
function updC(){$('counter').textContent=`${cur+1}/${SCREENS.length}`}
function setN(v){$('nextBtn').disabled=!v;$('nextBtn').classList.toggle('primary',v)}

// ========== HEADER ==========
function rHeader(back){
  $('header').innerHTML=`<div class="g-header"><div class="g-header-left">
    ${back?'<div class="g-back"><svg width="10" height="18" viewBox="0 0 10 18" fill="none"><path d="M9 1L1 9l8 8" stroke="#444746" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></div>':''}
    <div class="g-logo"><svg viewBox="0 0 24 24" width="30" height="30"><circle cx="12" cy="12" r="11" fill="#fff" stroke="#e0e0e0" stroke-width="1"/><path d="M6.5 12A5.5 5.5 0 0112 6.5v2A3.5 3.5 0 008.5 12h-2zm5.5 5.5A5.5 5.5 0 016.5 12h2a3.5 3.5 0 003.5 3.5v2zm0-11V4a8 8 0 018 8h-2.5A5.5 5.5 0 0012 6.5zm8 5.5a8 8 0 01-8 8v-2.5a5.5 5.5 0 005.5-5.5H20z" fill="url(#gg)"/><defs><linearGradient id="gg" x1="4" y1="4" x2="20" y2="20"><stop stop-color="#4285f4"/><stop offset=".33" stop-color="#9b72cb"/><stop offset=".66" stop-color="#d96570"/><stop offset="1" stop-color="#d96570"/></linearGradient></defs></svg></div>
  </div><div class="avatar-circle">M</div></div>`;
}
function rTabs(s){$('navTabs').innerHTML=s?'<div class="nav-tabs"><div class="tab active">AI Mode</div><div class="tab">Everything</div><div class="tab">Images</div><div class="tab">Videos</div><div class="tab">News</div></div>':'';}

// ========== INPUT BAR ‚Äî matches screenshot exactly ==========
const svgPlus='<svg width="18" height="18" viewBox="0 0 18 18" fill="none"><path d="M9 3.5v11M3.5 9h11" stroke="#444746" stroke-width="1.5" stroke-linecap="round"/></svg>';
const svgMic='<svg width="22" height="22" viewBox="0 0 24 24" fill="#444746"><path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5-3c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-2.08c3.39-.49 6-3.39 6-6.92h-2z"/></svg>';
const svgCam='<svg width="22" height="22" viewBox="0 0 24 24" fill="#444746"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/><circle cx="12" cy="12" r="3.5"/></svg>';
const svgX='<svg width="14" height="14" viewBox="0 0 14 14" fill="none"><path d="M2 2l10 10M12 2L2 12" stroke="#70757a" stroke-width="1.8" stroke-linecap="round"/></svg>';
const svgSend='<svg width="20" height="20" viewBox="0 0 24 24" fill="#fff"><path d="M3.4 20.4l17.45-7.48a1 1 0 000-1.84L3.4 3.6a1 1 0 00-1.4.92V9.5l13 2.5-13 2.5v4.98a1 1 0 001.4.92z"/></svg>';

function inputCompose(txt){
  $('inputBar').innerHTML=`<div class="input-bar">
    <div class="input-compose-box">
      <div class="input-compose-text">${txt}</div>
      <button class="input-dismiss" onclick="">${svgX}</button>
    </div>
    <div class="input-bottom-row">
      <button class="input-add-btn">${svgPlus}</button>
      <div class="input-right-icons">${svgMic}${svgCam}
        <button class="send-btn" onclick="sendMsg()">${svgSend}</button>
      </div>
    </div>
  </div>`;
}

function inputBlank(){
  $('inputBar').innerHTML=`<div class="input-bar">
    <div class="input-bottom-row" style="padding-top:4px">
      <button class="input-add-btn">${svgPlus}</button>
      <div style="flex:1;font-size:16px;color:var(--text3);padding:0 8px">Ask anything</div>
      <div class="input-right-icons">${svgMic}${svgCam}
        <button class="send-btn" style="background:#d3e3fd;cursor:default" disabled>${svgSend}</button>
      </div>
    </div>
  </div>`;
}

function showNextPrompt(){
  // Find next user-sends screen and pre-load it
  for(let i=cur+1;i<SCREENS.length;i++){
    if(SCREENS[i].type==='user-sends'){inputCompose(SCREENS[i].msg);return}
  }
  inputBlank();
}

// ========== BUILD BLOCKS ==========
function bCard(b){
  return`<div class="pcard"><div class="pthumb"><svg width="36" height="36" viewBox="0 0 24 24" fill="#9aa0a6"><path d="M20 18c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2H4c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2H0v2h24v-2h-4zM4 6h16v10H4V6z"/></svg></div>
  <div class="pinfo"><div class="pname">${b.name}</div><div class="pprice">${b.price}</div><div class="pmeta">‚òÖ ${b.brand} ${b.rating} (${b.reviews})</div></div></div>`;
}
function bTable(b){
  let h='<div class="ctable"><table><thead><tr>';
  b.headers.forEach(th=>h+=`<th>${th}</th>`);
  h+='</tr></thead><tbody>';
  b.rows.forEach(r=>{h+='<tr>';r.forEach(c=>h+=`<td>${c}</td>`);h+='</tr>'});
  return h+'</tbody></table></div>';
}
function bBlock(b){
  switch(b.t){
    case'h':return`<div class="heading">${b.text}</div>`;
    case'p':return`<div class="para">${b.text}</div>`;
    case'li':return`<div class="bullet">‚Ä¢ ${b.text}</div>`;
    case'card':return bCard(b);
    case'table':return bTable(b);
    default:return'';
  }
}
function bAll(bl){return bl.map(bBlock).join('')}

// ========== RENDER ==========
function rWelcome(){
  $('scrollArea').innerHTML=`<div class="welcome">
    <div class="welcome-spacer"></div>
    <h1>Hi Macie. What do you<br>have in mind?</h1>
    <div class="welcome-bottom"><div class="suggestions">
      <div class="suggestion-item"><span class="stxt">Tell me what types of plastics exist and if they can be recycled.</span><svg class="sicon" viewBox="0 0 24 24" fill="#70757a"><path d="M15.5 14h-.79l-.28-.27A6.47 6.47 0 0016 9.5 6.5 6.5 0 109.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg></div>
      <div class="suggestion-item"><span class="stxt">Free local events this week</span><svg class="sicon" viewBox="0 0 24 24" fill="#70757a"><path d="M15.5 14h-.79l-.28-.27A6.47 6.47 0 0016 9.5 6.5 6.5 0 109.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg></div>
      <div class="suggestion-item"><span class="stxt">Make a table comparing the different methods of making coffee</span><svg class="sicon" viewBox="0 0 24 24" fill="#70757a"><path d="M15.5 14h-.79l-.28-.27A6.47 6.47 0 0016 9.5 6.5 6.5 0 109.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg></div>
    </div></div></div>`;
}
function rMsgs(){let h='<div class="messages">';hist.forEach(m=>h+=m.html);h+='</div>';$('scrollArea').innerHTML=h;sBot()}

// ========== TYPEWRITER ==========
async function typeAI(blocks){
  busy=true;setN(false);
  const idx=hist.length;
  hist.push({type:'ai',html:'<div class="ai-block" id="aiLive"></div>'});
  rMsgs();
  const c=document.getElementById('aiLive');if(!c){busy=false;return}

  for(let i=0;i<blocks.length;i++){
    const b=blocks[i];
    const isT=b.t==='h'||b.t==='p'||b.t==='li';
    if(!isT){c.insertAdjacentHTML('beforeend',bBlock(b));sBot();await sleep(250);continue}

    const cls=b.t==='h'?'heading':b.t==='li'?'bullet':'para';
    const pre=b.t==='li'?'‚Ä¢ ':'';
    const el=document.createElement('div');el.className=cls;c.appendChild(el);
    const plain=strip(b.text);let ci=0;
    await new Promise(res=>{
      timer=setInterval(()=>{
        ci=Math.min(ci+3,plain.length);
        el.innerHTML=pre+plain.slice(0,ci)+'<span class="cursor"></span>';
        sBot();
        if(ci>=plain.length){clearInterval(timer);timer=null;el.innerHTML=pre+b.text;res()}
      },10);
    });
    await sleep(40);
  }
  hist[idx].html=`<div class="ai-block">${bAll(blocks)}</div>`;
  busy=false;setN(cur<SCREENS.length-1);
  // Show next user prompt in input
  showNextPrompt();
}

// ========== SCREEN FLOW ==========
async function show(i){
  cur=i;updC();const s=SCREENS[i];

  if(s.type==='welcome'){
    rHeader(false);rTabs(true);rWelcome();showNextPrompt();setN(true);return;
  }
  rHeader(true);rTabs(false);

  if(s.type==='user-sends'){sendMsg();return}

  if(s.type==='thinking'){
    inputBlank();
    hist.push({type:'thinking',html:'<div class="thinking-row"><div class="thinking-dot"></div><div class="thinking-dot"></div><div class="thinking-dot"></div><span class="thinking-label" id="thinkLbl">Thinking</span></div>'});
    rMsgs();setN(false);
    let d=0;dotTimer=setInterval(()=>{d=(d+1)%4;const e=document.getElementById('thinkLbl');if(e)e.textContent='Thinking'+'.'.repeat(d)},400);
    await sleep(2800);
    clearInterval(dotTimer);hist.pop();rMsgs();
    if(cur<SCREENS.length-1){advance()}else{setN(false)}
    return;
  }

  if(s.type==='ai-response'){
    inputBlank();rMsgs();await typeAI(s.content);return;
  }
}

// ========== ACTIONS ==========
function sendMsg(){
  // Find next user-sends from current position
  let ti=-1;
  for(let i=cur;i<SCREENS.length;i++){if(SCREENS[i].type==='user-sends'){ti=i;break}}
  if(ti===-1)return;
  const s=SCREENS[ti];
  cur=ti;updC();
  hist.push({type:'user',html:`<div class="user-row"><div class="user-msg">${s.msg}</div></div>`});
  inputBlank();rMsgs();
  setTimeout(()=>advance(),800);
}

function advance(){if(busy||cur>=SCREENS.length-1)return;show(cur+1)}

function resetDemo(){
  clearInterval(timer);clearInterval(dotTimer);autoP=false;busy=false;hist.length=0;
  $('autoBtn').textContent='‚ñ∂ Auto Play';$('autoBtn').classList.remove('primary');show(0);
}
function toggleAutoPlay(){
  autoP=!autoP;
  $('autoBtn').textContent=autoP?'‚è∏ Pause':'‚ñ∂ Auto Play';
  $('autoBtn').classList.toggle('primary',autoP);
  if(autoP&&!busy)advance();
}

show(0);
</script>
</body>
</html>
